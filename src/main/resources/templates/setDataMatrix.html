<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Set Data Matrix</title>
    <link rel="stylesheet" th:href="@{/style.css}">
</head>
<body>
<div class="buttons-container">
    <a th:href="@{/}"><button>–ì–ª–∞–≤–Ω–∞—è</button></a>
</div>

<div class="form-container">
    <h2>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø—ã –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ —Ñ–∞–π–ª–∞</h2>

    <div th:if="${successMessage}" class="alert alert-success">
        <span th:text="${successMessage}"></span>
    </div>
    <div th:if="${errorMessage}" class="alert alert-error">
        <span th:text="${errorMessage}"></span>
    </div>


    <form th:action="@{/setDataMatrix}" method="post">
        <button type="submit" class="btn-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø—ã</button>
    </form>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ -->
    <div th:if="${result}" class="results-section">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:</h3>

        <!-- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
        <div th:if="${result.hasMissingUsers()}" class="missing-section">
            <h4>‚ö† –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –º–∞—Ç—Ä–∏—Ü–µ:</h4>
            <ul>
                <li th:each="user : ${result.missingUsers}" th:text="${user}"></li>
            </ul>
            <p class="warning">–≠—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –ø—Ä–æ–ø—É—â–µ–Ω—ã –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π.</p>
        </div>

        <!-- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã -->
        <div th:if="${result.hasMissingFiles()}" class="missing-section">
            <h4>‚ö† –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –≤ –º–∞—Ç—Ä–∏—Ü–µ:</h4>
            <ul>
                <li th:each="file : ${result.missingFiles}" th:text="${file}"></li>
            </ul>
            <p class="warning">–≠—Ç–∏ —Ñ–∞–π–ª—ã –±—É–¥—É—Ç –ø—Ä–æ–ø—É—â–µ–Ω—ã –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π.</p>
        </div>

        <!-- –û—à–∏–±–∫–∏ (–±–µ–∑ checkbox) -->
        <div th:if="${result.hasErrors()}" class="errors-section">
            <h4>‚ùå –û—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:</h4>
            <div class="errors-list">
                <div th:each="error : ${result.errors}" class="error-item">
                    <span th:text="${error}" class="error-text"></span>
                </div>
            </div>
        </div>

        <!-- –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Å checkbox) -->
        <div th:if="${result.hasCorrections()}" class="corrections-section">
            <h4>üîß –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</h4>
            <form th:action="@{/setDataMatrix/apply}" method="post" id="applyForm">
                <div class="corrections-list">
                    <div th:each="correction, status : ${result.corrections}" class="correction-item">
                        <input type="checkbox"
                               th:name="correctionsToApply"
                               th:value="${result.correctionsToApply[status.index]}"
                               checked>
                        <span th:text="${correction}" class="correction-text"></span>
                    </div>
                </div>

                <div th:if="${result.hasItemsToApply()}" class="actions">
                    <button type="submit" class="btn-apply">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                    <button type="button" onclick="selectAll()" class="btn-secondary">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
                    <button type="button" onclick="deselectAll()" class="btn-secondary">–°–Ω—è—Ç—å –≤—Å–µ</button>
                </div>
            </form>
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π -->
        <div th:if="${result.corrections.size() == 1 and result.corrections[0].contains('–í—Å–µ –¥–æ—Å—Ç—É–ø—ã')}" class="success-section">
            <h4>‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞:</h4>
            <p th:text="${result.corrections[0]}" class="success-text"></p>
        </div>

        <!-- –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è -->
        <div th:if="${appliedCorrections}" class="applied-section">
            <h4>‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:</h4>
            <ul>
                <li th:each="applied : ${appliedCorrections}" th:text="${applied}"></li>
            </ul>
        </div>
    </div>
</div>

<script>
    function selectAll() {
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.checked = true;
        });
    }

    function deselectAll() {
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.checked = false;
        });
    }
</script>
</body>
</html>